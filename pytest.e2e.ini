# ==============================================================================
# PYTEST CONFIGURATION FOR E2E TESTS
# ==============================================================================
# pytest.e2e.ini - Configuration specifically for E2E test suite
#
# Usage:
#   pytest -c pytest.e2e.ini tests/e2e/
# ==============================================================================

[pytest]
# ==============================================================================
# TEST DISCOVERY
# ==============================================================================
testpaths = tests/e2e
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ==============================================================================
# MARKERS
# ==============================================================================
markers =
    e2e: End-to-end tests (full system flows)
    smoke: Smoke tests (critical paths only)
    slow: Tests that take > 5 seconds
    fast: Tests that take < 2 seconds
    user_journey: Complete user journey tests
    multi_market: Tests involving market switching
    mcp: MCP conversational flow tests
    performance: Performance-related tests
    concurrent: Tests with concurrent requests
    redis_required: Tests requiring Redis
    skip_ci: Skip in CI environment

# ==============================================================================
# ASYNC SUPPORT
# ==============================================================================
asyncio_mode = auto

# ==============================================================================
# OUTPUT & REPORTING
# ==============================================================================
# Verbose output
addopts = 
    -v
    --strict-markers
    --tb=short
    --disable-warnings
    # Coverage (optional for E2E)
    # --cov=src
    # --cov-report=term-missing
    # --cov-report=html:htmlcov_e2e
    # Performance tracking
    --durations=10
    # Color output
    --color=yes
    # Show local variables in tracebacks
    -l

# ==============================================================================
# TIMEOUTS
# ==============================================================================
# Global timeout for all tests (30 seconds)
timeout = 30
# Method for timeout
timeout_method = thread

# ==============================================================================
# LOGGING
# ==============================================================================
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/e2e_tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ==============================================================================
# WARNINGS
# ==============================================================================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # Ignore specific warnings from dependencies
    ignore:.*pkg_resources.*:DeprecationWarning

# ==============================================================================
# ENVIRONMENT
# ==============================================================================
# Load .env.test file
env_files =
    .env.test

# ==============================================================================
# PLUGINS
# ==============================================================================
# Required plugins (install via pip)
required_plugins =
    pytest-asyncio
    pytest-timeout
    pytest-env

# ==============================================================================
# PARALLEL EXECUTION (Optional - requires pytest-xdist)
# ==============================================================================
# Uncomment to enable parallel execution
# addopts = -n auto

# ==============================================================================
# NOTES:
# ==============================================================================
# - Ensure Redis is running before executing E2E tests
# - Use markers to selectively run test subsets:
#     pytest -m "e2e and not slow"
#     pytest -m "smoke"
#     pytest -m "user_journey"
# - For CI, use: pytest -m "e2e and not skip_ci"
# ==============================================================================